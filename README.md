# Telegram Бот для опитування з анонімною збіркою відповідей

Бот, який збирає анонімні відповіді на питання від групи користувачів і надсилає їх тільки власнику.

## Функції

- **Встановлення власника**: `/iamowner` — стати власником, якому надходять всі відповіді
- **Встановлення питання**: `/setquestion Ваше питання` — власник встановлює питання для користувачів
- **Збір відповідей**: Користувачи просто пишуть текст, який автоматично відправляється власнику
- **Конфіденційність**: Користувачи видять тільки юзернейм відправника, ID приховано

## Встановлення залежностей

```bash
sudo apt-get update
sudo apt-get install -y libcurl4-openssl-dev nlohmann-json3-dev
```

## Компіляція

```bash
make
```

## Використання

1. **Задайте токен бота** через змінну оточення `BOT_TOKEN` (не потрібно змінювати `bot.cpp`).

2. **Компіляція і запуск** (локально):

```bash
make
# Запуск (альтернативно використовуйте ./run.sh)
BOT_TOKEN=your_token_here PORT=10000 ./bot
```

Чтобы удобнее перезапускать бот и автоматически останавливать старую копию, можно использовать предоставленный `run.sh`:

```bash
# сделать исполняемым один раз
chmod +x run.sh
# запуск с токеном
BOT_TOKEN=your_token_here ./run.sh 10000
```

3. **В Telegram**:
   - Напишіть боту `/iamowner`
   - Напишіть `/setquestion Ваше питання тут`
   - Поділіться посиланням на бота з іншими користувачами
   - Вони напишуть відповіді, які надійдуть вам

## Файли конфігурації

- `owner_id.txt` — ID власника (автоматично зберігається)
- `question.txt` — Актуальне питання (автоматично зберігається)

## Команди

### Для власника
- `/iamowner` — Встановити себе власником
- `/setquestion текст` — Встановити питання

### Для всіх користувачів
- `/start` — Показати інформацію
- Просто напишіть текст — буде надіслано як відповідь

## Деплой на Render (Web Service, безкоштовний план)

1. Заведіть репозиторій на GitHub і запуште цей проект.
2. Увійдіть в Render, натисніть "New" → "Web Service" → підключіть репозиторій.
3. В полі **Environment** виберіть `Docker` (Render побудує образ з `Dockerfile`).
4. Налаштуйте змінні оточення (`Environment Variables`):
   - `BOT_TOKEN` — токен вашого Telegram бота
   - `OWNER_ID` — (опціонально) ID власника
   - `SUPABASE_URL` і `SUPABASE_KEY` — якщо використовуєте Supabase
5. Build & Start:
   - Render використає `Dockerfile` для збірки і запуску (CMD `./bot`).
   - Render задає змінну `PORT` автоматично; бот слухає `PORT`.
6. Після деплою дивіться логи сервісу — бот повинен стартувати і показувати `=== БОТ ЗАПУЩЕНО ===`.

Automatic webhook setup
 - Якщо задати в Render змінну оточення `WEBHOOK_URL` (наприклад `https://your-service.onrender.com/webhook`) та `BOT_TOKEN`, бот автоматично виконає `setWebhook` при старті і зареєструє webhook. Інакше можна викликати `setWebhook` вручну за допомогою `curl`.

Assets / логотипи
- Завантажте іконку сервісу в Render UI (рекомендовано `assets/logo-512.png` або `assets/icon.svg`).
- В репозиторії додано `assets/icon.svg` і `assets/logo-512.png` як placeholder-версії — замініть на власні при необхідності.

Примітка: Dockerfile вже налаштований для установки залежностей і збірки бінарника всередині образу.

---

Додаткові поради для розгортання на Render

- Build: виберіть `Docker` при створенні Web Service — Render використовує `Dockerfile` в корені репозиторію.
- Environment Variables (обов'язково/рекомендовано):
   - `BOT_TOKEN` — (обов'язково) токен Telegram бота
   - `OWNER_ID` — (опціонально) Telegram ID власника
   - `WEBHOOK_URL` — (опціонально) повний URL вашого сервісу з `/webhook` (наприклад `https://your-service.onrender.com/webhook`). Якщо задано — бот автоматично викличе `setWebhook` при старті.
   - `SUPABASE_URL` / `SUPABASE_KEY` — (опціонально) якщо хочете зберігати відповіді в Supabase

Після деплою подивіться логи сервісу — якщо `WEBHOOK_URL` задано, ви побачите лог з відповіддю `setWebhook`.

Якщо локальна збірка не проходить через відсутній `nlohmann/json.hpp` — скористайтесь одним з варіантів:

1) Встановити пакет локально (Linux):

```bash
sudo apt-get update
sudo apt-get install -y libcurl4-openssl-dev nlohmann-json3-dev
make
```

2) Довірити збірку Render/Docker — `Dockerfile` вже встановлює `nlohmann-json3-dev`, тому збірка в хмарі пройде і збере бінарник.

Якщо хочеш, я можу додати варіант з vendor-версією `nlohmann/json.hpp` у репозиторій для повної локальної збірки без apt.